<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Editor TinyMCE com Autocomplete LocalStorage</title>
    <script src="./assets/dist/js/tinymce/tinymce.min.js"></script> </head>
<body>

<h1>Editor TinyMCE</h1>

<textarea id="editor"></textarea>
<button id="salvar">Salvar Palavras</button>

<script>
    tinymce.init({
        selector: 'textarea#editor',
        menubar: false,
        statusbar: false,
        toolbar: false,
        plugins: [],
        setup: (editor) => {
            editor.ui.registry.addAutocompleter('localstorage', {
                trigger: ' ', // Correção: usa 'trigger' em vez de 'ch'
                minChars: 2,
                fetch: (pattern) => {
                    return new Promise((resolve) => {
                        const palavrasSalvas = JSON.parse(localStorage.getItem('palavras')) || [];
                        const sugestoes = palavrasSalvas.filter(palavra => palavra.toLowerCase().startsWith(pattern.toLowerCase()));
                        resolve(sugestoes.map(palavra => ({ value: palavra })));
                    });
                },
                onAction: (autocompleteApi, rng, value) => {
                    editor.selection.setRng(rng);
                    editor.insertContent(value + ' ');
                    autocompleteApi.hide();
                }
            });
        }
    });

    const botaoSalvar = document.getElementById('salvar');
    botaoSalvar.addEventListener('click', () => {
        const conteudoEditor = tinymce.get('editor').getContent();
        const palavras = conteudoEditor.split(/\s+/).filter(palavra => palavra.length > 0); // Divide o texto em palavras
        localStorage.setItem('palavras', JSON.stringify(palavras));
        console.log("Palavras salvas:", palavras)
    });

       // Carregar palavras do localStorage ao iniciar a página
    window.addEventListener('DOMContentLoaded', () => {
        if (localStorage.getItem('palavras')) {
            const palavras = JSON.parse(localStorage.getItem('palavras'));
           // console.log('Palavras carregadas:', palavras);
        }
        //Se não existir palavras ele ira criar um array vazio no localStorage
        else {
            const palavras = [];
            localStorage.setItem('palavras', JSON.stringify(palavras));
        }
    })
    
</script>

</body>
</html>